<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<div class="w-full max-w-[1200px] mx-auto mt-6 px-4">

  <div class="rounded-2xl bg-[#1F2937]/60 border border-white/10 shadow-lg p-5">

    <!-- Search + Filters Row -->
    <div class="mb-4">
      <div class="flex flex-col md:flex-row items-center gap-3">

        <!-- Search -->
        <div class="flex items-center flex-1 bg-[#0F172A] border border-white/10 rounded-lg py-2 px-3">
          <i class="fas fa-search text-[#F0F9FF]/70 mr-3"></i>
          <input
            id="hospital-search-input"
            type="text"
            class="bg-transparent outline-none w-full text-[#F0F9FF]"
            placeholder="Search hospitals by name, address, or network..."
            [(ngModel)]="searchHospital"
            (input)="searchHospitals()"
          />
        </div>

        <!-- Improved Filter Buttons UI with Green + Blue Buttons -->
        <div class="flex flex-wrap items-center gap-2">

          <!-- Network Only (Green Button) -->
          <button
            id="network-filter-btn"
            (click)="filterNetworkHospitals()"
            [ngClass]="networkButtonClass"
            class="inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-sm font-medium
                  bg-green-600 text-white hover:bg-green-700 transition shadow-sm">
            <i class="fas fa-sitemap text-sm"></i>
            <span>Network Only</span>
          </button>

          <!-- Rating (Blue Button) -->
          <button
            id="rating-filter-btn"
            (click)="onRatingButtonPressed()"
            [ngClass]="ratingButtonClass"
            class="inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-sm font-medium
                  bg-blue-600 text-white hover:bg-blue-700 transition shadow-sm">
            <i class="fas fa-star text-sm"></i>
            <span>Rating</span>
          </button>

          <!-- Sort Asc -->
          <button
            id="asc-btn"
            (click)="onAscendingButtonPressed()"
            class="inline-flex items-center justify-center w-9 h-9 rounded-lg bg-[#111827] 
                  border border-white/10 text-[#F0F9FF] hover:bg-[#1F2937] transition">
            <i class="fas fa-sort-up"></i>
          </button>

          <!-- Sort Desc -->
          <button
            id="desc-btn"
            (click)="onDescendingButtonPressed()"
            class="inline-flex items-center justify-center w-9 h-9 rounded-lg bg-[#111827] 
                  border border-white/10 text-[#F0F9FF] hover:bg-[#1F2937] transition">
            <i class="fas fa-sort-down"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Add/Edit Hospital Form -->
    <div class="rounded-lg bg-[#0F172A] border border-white/6 p-4 mb-5">
      <div class="flex items-center justify-between mb-3">
        <h5 class="text-lg font-semibold text-[#F0F9FF]">
          {{ editMode ? 'Edit Hospital' : 'Add Hospital' }}
        </h5>
      </div>

      <form [formGroup]="hospitalForm" class="space-y-3">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-3">

          <div class="md:col-span-4">
            <input
              type="text"
              class="w-full rounded-md bg-[#111827] border border-white/10 text-[#F0F9FF] px-3 py-2"
              formControlName="name"
              placeholder="Hospital Name"
            />
            @if(hospitalForm.get('name')?.touched && hospitalForm.get('name')?.invalid){
              <div class="text-red-400 text-xs mt-1">
                @if(hospitalForm.get('name')?.errors?.['required']) { Hospital name is required. }
                @if(hospitalForm.get('name')?.errors?.['alphabetsOnly']) { Only alphabets are allowed in the name. }
              </div>
            }
          </div>

          <div class="md:col-span-2">
            <input
              type="text"
              class="w-full rounded-md bg-[#111827] border border-white/10 text-[#F0F9FF] px-3 py-2"
              formControlName="clientContactNumber"
              placeholder="Phone No."
            />
            @if(hospitalForm.get('clientContactNumber')?.touched && hospitalForm.get('clientContactNumber')?.invalid){
              <div class="text-red-400 text-xs mt-1">
                @if(hospitalForm.get('clientContactNumber')?.errors?.['required']) { Phone number is required. }
                @if(hospitalForm.get('clientContactNumber')?.errors?.['pattern']) { Phone number must be 10 digits numeric only. }
              </div>
            }
          </div>

          <div class="md:col-span-3">
            <input
              type="email"
              class="w-full rounded-md bg-[#111827] border border-white/10 text-[#F0F9FF] px-3 py-2"
              formControlName="clientContactEmail"
              placeholder="Email Id"
            />
            @if(hospitalForm.get('clientContactEmail')?.touched && hospitalForm.get('clientContactEmail')?.invalid){
              <div class="text-red-400 text-xs mt-1">
                @if(hospitalForm.get('clientContactEmail')?.errors?.['required']) { Email is required. }
                @if(hospitalForm.get('clientContactEmail')?.errors?.['email']) { Enter a valid email. }
              </div>
            }
          </div>

          <div class="md:col-span-3">
            <input
              type="text"
              class="w-full rounded-md bg-[#111827] border border-white/10 text-[#F0F9FF] px-3 py-2"
              formControlName="address"
              placeholder="Address"
            />
            @if(hospitalForm.get('address')?.touched && hospitalForm.get('address')?.invalid){
              <div class="text-red-400 text-xs mt-1">
                @if(hospitalForm.get('address')?.errors?.['required']) { Address is required. }
              </div>
            }
          </div>

          <div class="md:col-span-3">
            <input
              type="number"
              class="w-full rounded-md bg-[#111827] border border-white/10 text-[#F0F9FF] px-3 py-2"
              formControlName="rating"
              placeholder="Rating"
              min="0" max="5" step="0.1"
            />
            @if(hospitalForm.get('rating')?.touched && hospitalForm.get('rating')?.invalid){
              <div class="text-red-400 text-xs mt-1">
                @if(hospitalForm.get('rating')?.errors?.['required']) { Rating is required. }
                @if(hospitalForm.get('rating')?.errors?.['min']) { Rating must be at least 0. }
                @if(hospitalForm.get('rating')?.errors?.['max']) { Rating must be at most 5. }
              </div>
            }
          </div>

          <div class="md:col-span-3">
            <select
              class="w-full rounded-md bg-[#111827] border border-white/10 text-[#F0F9FF] px-3 py-2"
              formControlName="network"
            >
              <option [value]="1">Network</option>
              <option [value]="0">Non-Network</option>
            </select>
            @if(hospitalForm.get('network')?.touched && hospitalForm.get('network')?.invalid){
              <div class="text-red-400 text-xs mt-1">
                @if(hospitalForm.get('network')?.errors?.['required']) { Network selection is required. }
              </div>
            }
          </div>

        </div>

        <div class="mt-3 flex items-center justify-end gap-3">
          <button
            type="button"
            (click)="onHospitalFormSubmit()"
            class="px-4 py-2 rounded-md bg-green-600 hover:bg-green-500 text-white font-semibold"
          >
            {{ editMode ? 'Update' : 'Add' }}
          </button>

          @if(editMode){
            <button
              type="button"
              class="px-4 py-2 rounded-md bg-[#111827] border border-white/10 text-[#F0F9FF]"
              (click)="cancelEdit()"
            >
              Cancel
            </button>
          }
        </div>
      </form>
    </div>

    <!-- Hospital Table -->
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm text-[#F0F9FF]/90">
        <thead class="bg-[#111827] text-[#F0F9FF]">
          <tr>
            <th class="p-3 text-left">S.No</th>
            <th class="p-3 text-left">Hospital Name</th>
            <th class="p-3 text-left">Phone No.</th>
            <th class="p-3 text-left">Email Id</th>
            <th class="p-3 text-left">Address</th>
            <th class="p-3 text-center">Rating</th>
            <th class="p-3 text-center">Network</th>
            <th class="p-3 text-center">Edit</th>
            <th class="p-3 text-center">Delete</th>
          </tr>
        </thead>

        <tbody class="divide-y divide-white/8">
          @for(item of filteredHospitalList; track $index){
            <tr class="hover:bg-[#2563EB]/6 transition">
              <td class="p-3 align-middle">{{ $index + 1 }}</td>
              <td class="p-3 align-middle">{{ item.name }}</td>
              <td class="p-3 align-middle">{{ item.clientContactNumber }}</td>
              <td class="p-3 align-middle">{{ item.clientContactEmail }}</td>
              <td class="p-3 align-middle max-w-[360px] truncate">{{ item.address }}</td>

              <!-- Rating pill -->
              <td class="p-3 text-center align-middle">
                <span
                  class="inline-block px-3 py-1 rounded-md text-xs font-semibold"
                  [ngClass]="{
                    'bg-red-600 text-white': item.rating < 2,
                    'bg-yellow-500 text-black': item.rating >= 2 && item.rating < 4,
                    'bg-green-600 text-white': item.rating >= 4
                  }">
                  {{ item.rating | number:'1.1-1' }}
                </span>
              </td>

              <!-- Network tick/cross -->
              <td class="p-3 text-center align-middle">
                @if (item.network == 1) {
                  <span class="text-green-400 font-bold">✔</span>
                }
                @else if (item.network == 0) {
                  <span class="text-red-400 font-bold">✖</span>
                }
              </td>

              <td class="p-3 text-center align-middle">
                <button class="px-3 py-1 rounded-md border border-white/10 text-[#F0F9FF]" (click)="editHospital(item)">Edit</button>
              </td>

              <td class="p-3 text-center align-middle">
                <button class="px-3 py-1 rounded-md border border-red-600 text-red-400 hover:bg-red-600/10" (click)="deleteHospital(item)">Delete</button>
              </td>
            </tr>
          }
          @if(filteredHospitalList && filteredHospitalList.length === 0) {
            <tr>
              <td colspan="9" class="p-6 text-center text-[#F0F9FF]/60">No hospitals found</td>
            </tr>
          }
        </tbody>
      </table>
    </div>

  </div>
</div>
