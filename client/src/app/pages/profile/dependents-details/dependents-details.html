<div class="max-w-[1200px] mx-auto px-4">

  <div class="grid gap-4">

    <!-- Dependents header -->
    <div class="flex items-center justify-between">
      <h3 class="text-xl font-semibold text-[#F0F9FF]">Dependents</h3>
      <p class="text-sm text-[#F0F9FF]/70">Manage your added dependents here</p>
    </div>

    <!-- Dependents list (cards) -->
    <div class="grid gap-4">
      @for (dep of dependents; track $index) {
        <div class="group bg-[#1F2937]/60 border border-white/10 rounded-xl p-4 shadow-md
                    transform transition duration-200 hover:-translate-y-1 hover:scale-[1.01]">
          <form #depForm="ngForm" (ngSubmit)="save(dep)" novalidate>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">

              <!-- NAME -->
              <div class="flex flex-col">
                <label class="text-sm text-[#F0F9FF]/70 mb-1">Name</label>

                @if (!dep.editing) {
                  <div class="text-[#F0F9FF]">{{ dep.name || '—' }}</div>
                }
                @else {
                  <input
                    class="rounded-md bg-[#0F172A] border border-white/10 text-[#F0F9FF] px-3 py-2 focus:outline-none"
                    [(ngModel)]="dep.temp!.name"
                    name="name_{{$index}}"
                    required
                    minlength="2"
                    #nameModel="ngModel"
                    placeholder="Enter name" />
                  <div class="text-xs text-rose-400 mt-1" *ngIf="nameModel.invalid && (nameModel.dirty || nameModel.touched)">
                    <small *ngIf="nameModel.errors?.['required']">Name is required.</small>
                    <small *ngIf="nameModel.errors?.['minlength']">Minimum 2 characters.</small>
                  </div>
                }
              </div>

              <!-- DOB -->
              <div class="flex flex-col">
                <label class="text-sm text-[#F0F9FF]/70 mb-1">Date of Birth</label>

                @if (!dep.editing) {
                  <div class="text-[#F0F9FF]">{{ dep.dob || '—' }}</div>
                }
                @else {
                  <input
                    type="date"
                    class="rounded-md bg-[#0F172A] border border-white/10 text-[#F0F9FF] px-3 py-2 focus:outline-none"
                    [(ngModel)]="dep.temp!.dob"
                    name="dob_{{$index}}" />
                }
              </div>

              <!-- CONTACT -->
              <div class="flex flex-col">
                <label class="text-sm text-[#F0F9FF]/70 mb-1">Contact</label>

                @if (!dep.editing) {
                  <div class="text-[#F0F9FF]">{{ dep.phone || '—' }}</div>
                }
                @else {
                  <input
                    type="tel"
                    class="rounded-md bg-[#0F172A] border border-white/10 text-[#F0F9FF] px-3 py-2 focus:outline-none"
                    [(ngModel)]="dep.temp!.phone"
                    name="phone_{{$index}}"
                    required
                    pattern="^[0-9]{10}$"
                    maxlength="10"
                    #phoneModel="ngModel"
                    placeholder="10-digit phone" />
                  <div class="text-xs text-rose-400 mt-1" *ngIf="phoneModel.invalid && (phoneModel.dirty || phoneModel.touched)">
                    <small *ngIf="phoneModel.errors?.['required']">Phone is required.</small>
                    <small *ngIf="phoneModel.errors?.['pattern']">Phone must be exactly 10 digits.</small>
                  </div>
                }
              </div>

              <!-- ADDRESS -->
              <div class="flex flex-col">
                <label class="text-sm text-[#F0F9FF]/70 mb-1">Address</label>

                @if (!dep.editing) {
                  <div class="text-[#F0F9FF]">{{ dep.address || '—' }}</div>
                }
                @else {
                  <input
                    class="rounded-md bg-[#0F172A] border border-white/10 text-[#F0F9FF] px-3 py-2 focus:outline-none"
                    [(ngModel)]="dep.temp!.address"
                    name="address_{{$index}}"
                    required
                    minlength="5"
                    #addrModel="ngModel"
                    placeholder="Enter address" />
                  <div class="text-xs text-rose-400 mt-1" *ngIf="addrModel.invalid && (addrModel.dirty || addrModel.touched)">
                    <small *ngIf="addrModel.errors?.['required']">Address is required.</small>
                    <small *ngIf="addrModel.errors?.['minlength']">Minimum 5 characters.</small>
                  </div>
                }
              </div>

              <!-- RELATION -->
              <div class="flex flex-col">
                <label class="text-sm text-[#F0F9FF]/70 mb-1">Relation</label>

                @if (dep.editing && dep.isNew) {
                  <select
                    class="rounded-md bg-[#0F172A] border border-white/10 text-[#F0F9FF] px-3 py-2 focus:outline-none"
                    [(ngModel)]="dep.temp!.relationName"
                    name="relation_{{$index}}">
                    <option value="" disabled selected>Select relation</option>
                    @for (option of relationOptions; track option.value) {
                      <option [value]="option.value">{{ option.label }}</option>
                    }
                  </select>
                }
                @else {
                  <div class="text-[#F0F9FF]">{{ dep.relationName || '—' }}</div>
                }
              </div>

              <!-- GENDER -->
              <div class="flex flex-col">
                <label class="text-sm text-[#F0F9FF]/70 mb-1">Gender</label>

                @if (!dep.editing) {
                  <div class="text-[#F0F9FF]">{{ dep.gender || '—' }}</div>
                }
                @else {
                  <select
                    class="rounded-md bg-[#0F172A] border border-white/10 text-[#F0F9FF] px-3 py-2 focus:outline-none"
                    [(ngModel)]="dep.temp!.gender"
                    name="gender_{{$index}}">
                    <option value="" disabled selected>Select gender</option>
                    <option value="M">M</option>
                    <option value="F">F</option>
                  </select>
                }
              </div>

              <!-- EMAIL -->
              <div class="flex flex-col">
                <label class="text-sm text-[#F0F9FF]/70 mb-1">Email</label>

                @if (!dep.editing) {
                  <div class="text-[#F0F9FF]">{{ dep.email || '—' }}</div>
                }
                @else {
                  <input
                    type="email"
                    class="rounded-md bg-[#0F172A] border border-white/10 text-[#F0F9FF] px-3 py-2 focus:outline-none"
                    [(ngModel)]="dep.temp!.email"
                    name="email_{{$index}}"
                    required
                    #emailModel="ngModel"
                    placeholder="name@example.com" />
                  <div class="text-xs text-rose-400 mt-1" *ngIf="emailModel.invalid && (emailModel.dirty || emailModel.touched)">
                    <small *ngIf="emailModel.errors?.['required']">Email is required.</small>
                    <small *ngIf="emailModel.errors?.['email']">Enter a valid email address.</small>
                  </div>
                }
              </div>

            </div>

            <!-- TS-side summary errors -->
            @if (dep.validationErrors?.length) {
              <div class="mt-3 text-sm text-rose-400">
                @for (e of dep.validationErrors; track $index) {
                  <div>{{ e }}</div>
                }
              </div>
            }

            <!-- Actions -->
            <div class="mt-4 flex items-center justify-between">
              <div class="flex items-center gap-2">
                @if (!dep.editing) {
                  <button type="button" (click)="edit(dep)" class="px-3 py-1 rounded-md bg-[#2563EB] hover:bg-[#3B82F6] text-white text-sm">
                    Edit
                  </button>
                }
                @else {
                  <button type="submit" class="px-3 py-1 rounded-md bg-[#2563EB] hover:bg-[#3B82F6] text-white text-sm" [disabled]="depForm.invalid">
                    Save
                  </button>

                  <button type="button" (click)="cancel(dep)" class="px-3 py-1 rounded-md border border-white/10 text-[#F0F9FF]/90 text-sm">
                    Cancel
                  </button>
                }
              </div>

              @if (!dep.editing) {
                <button type="button" (click)="delete(dep)" class="px-3 py-1 rounded-md bg-[#111827] border border-white/10 text-[#F0F9FF] text-sm">
                  Delete
                </button>
              }
            </div>
          </form>
        </div>
      }
    </div>

    <!-- Add dependent / footer area -->
    <div class="mt-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <button
          class="px-4 py-2 rounded-md bg-[#2563EB] hover:bg-[#3B82F6] text-white"
          (click)="addDependent()"
          [disabled]="!canAddDependent()"
          title="Maximum of 4 dependents allowed">
          Add Dependent
        </button>

        @if (!canAddDependent()) {
          <div class="text-sm text-[#F0F9FF]/70">You’ve reached the maximum of {{ maxDependents }} dependents.</div>
        }
      </div>

      <div class="text-sm text-[#F0F9FF]/60">
        Tip: click <span class="px-2 py-0.5 bg-white/5 rounded">Edit</span> to update a dependent.
      </div>
    </div>

  </div>
</div>
